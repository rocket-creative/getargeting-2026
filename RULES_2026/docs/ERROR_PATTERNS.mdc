# ERROR_PATTERNS.mdc
## Recurring Errors & Anti-Patterns Log

THIS FILE TRACKS ERRORS THAT HAVE OCCURRED REPEATEDLY.
The assistant MUST check this file before generating any code.
If an error from this list is about to be repeated, STOP and fix it proactively.

---

## How to Use This File

1. **Before coding:** Read this entire file
2. **During coding:** Check your output against these patterns
3. **After errors:** Add new patterns to this file
4. **Format:** Each error includes the pattern, why it's wrong, and the correct approach

---

## CATEGORY: Typography & Design

### ERR-001: Using font-weight 500 (Medium)
**Pattern:** `font-weight: 500` or `font-medium`
**Why it's wrong:** Design philosophy mandates exactly 2 weights: 400 (regular) and 600 (semibold)
**Correct approach:** Use `font-normal` (400) or `font-semibold` (600) only
**Rule reference:** design-philosophy.mdc - Typography Principles

### ERR-002: Loading too many font weights
**Pattern:** `weight: ['400', '500', '600', '700']` in font imports
**Why it's wrong:** Violates 2-weight rule and hurts performance
**Correct approach:** `weight: ['400', '600']` only
**Rule reference:** design-philosophy.mdc, performance.mdc

### ERR-003: Using colors outside project palette
**Pattern:** Using colors not defined in project design system
**Why it's wrong:** Breaks visual consistency, violates design system
**Correct approach:** Use only colors defined in project-specific design system
**Rule reference:** design-system.mdc

### ERR-004: Inconsistent button styles
**Pattern:** Mixing rounded-lg, rounded-full, different padding across buttons
**Why it's wrong:** Buttons should follow signature pill pattern
**Correct approach:** Use consistent button classes throughout project
**Rule reference:** design-philosophy.mdc - Component Principles

---

## CATEGORY: SEO & Metadata

### ERR-005: Missing or duplicate meta descriptions
**Pattern:** Pages without unique `description` in metadata export
**Why it's wrong:** Hurts SEO, causes duplicate content issues
**Correct approach:** Every page.tsx MUST have unique title and description
**Rule reference:** seo-ai-readability.mdc - Section 1

### ERR-006: Using meta keywords tag
**Pattern:** `keywords: ['keyword1', 'keyword2']` in metadata
**Why it's wrong:** Obsolete since 2009, can signal spam
**Correct approach:** NEVER include keywords meta tag
**Rule reference:** seo-ai-readability.mdc - Section 11

### ERR-007: Missing canonical URLs
**Pattern:** No `alternates: { canonical: '...' }` in metadata
**Why it's wrong:** Causes duplicate content issues across domains
**Correct approach:** Every page needs canonical URL
**Rule reference:** seo-ai-readability.mdc - Section 1

### ERR-008: Missing structured data
**Pattern:** Pages without JSON-LD schema
**Why it's wrong:** Reduces search visibility and AI comprehension
**Correct approach:** Every page needs appropriate schema type
**Rule reference:** seo-ai-readability.mdc - Section 2

### ERR-009: Missing BreadcrumbList schema
**Pattern:** Non-homepage pages without breadcrumb schema
**Why it's wrong:** Reduces rich result eligibility
**Correct approach:** All pages except homepage need BreadcrumbList
**Rule reference:** seo-ai-readability.mdc - Section 2

---

## CATEGORY: Content & Copy

### ERR-010: Using hyphens in copy
**Pattern:** "well-being", "self-care", "state-of-the-art"
**Why it's wrong:** Content rules forbid hyphens
**Correct approach:** Rewrite: "wellbeing", "self care", "cutting edge"
**Rule reference:** content-copy.mdc

### ERR-011: Phone numbers with hyphens
**Pattern:** `+1-555-123-4567`
**Why it's wrong:** Hyphens forbidden in copy
**Correct approach:** `(555) 123 4567` or `555.123.4567`
**Rule reference:** content-copy.mdc

### ERR-012: Title Case in headings
**Pattern:** "Our Services And Treatments"
**Why it's wrong:** Should use sentence case
**Correct approach:** "Our services and treatments"
**Rule reference:** content-copy.mdc

### ERR-013: Missing Oxford comma
**Pattern:** "therapy, wellness and beauty"
**Why it's wrong:** Oxford comma is required
**Correct approach:** "therapy, wellness, and beauty"
**Rule reference:** content-copy.mdc

---

## CATEGORY: Accessibility

### ERR-014: Missing alt text on images
**Pattern:** `<img src="..." />` or `<Image ... />` without alt
**Why it's wrong:** WCAG violation, screen readers can't describe image
**Correct approach:** Always include descriptive alt text
**Rule reference:** accessibility.mdc

### ERR-015: Removing focus outlines without replacement
**Pattern:** `outline: none` or `focus:outline-none` without visible alternative
**Why it's wrong:** Keyboard users can't see focus state
**Correct approach:** Replace with visible focus ring
**Rule reference:** accessibility.mdc

### ERR-016: Click-only interactions
**Pattern:** `onClick` without keyboard equivalent
**Why it's wrong:** Keyboard users can't interact
**Correct approach:** Use `<button>` or add `onKeyDown` handler
**Rule reference:** accessibility.mdc

### ERR-017: Missing form labels
**Pattern:** `<input placeholder="Email" />` without label
**Why it's wrong:** Screen readers can't identify field
**Correct approach:** Always include `<label>` or `aria-label`
**Rule reference:** accessibility.mdc

---

## CATEGORY: Privacy & Tracking

### ERR-018: Loading scripts before consent
**Pattern:** Analytics/tracking in layout without consent check
**Why it's wrong:** Violates GDPR/CCPA, privacy-compliance.mdc
**Correct approach:** Wrap in consent check: `{consent?.analytics && <Script ... />}`
**Rule reference:** privacy-compliance.mdc

### ERR-019: Pre-checked consent boxes
**Pattern:** `<input type="checkbox" checked />` for marketing consent
**Why it's wrong:** Dark pattern, violates consent rules
**Correct approach:** All non-essential consent must be unchecked by default
**Rule reference:** privacy-compliance.mdc

### ERR-020: Missing GPC (Global Privacy Control) handling
**Pattern:** No check for `navigator.globalPrivacyControl`
**Why it's wrong:** Must honor GPC as opt-out signal
**Correct approach:** Check GPC and auto-reject non-essential if true
**Rule reference:** privacy-compliance.mdc

---

## CATEGORY: Security

### ERR-021: Client-side secrets
**Pattern:** API keys, tokens in client components or .env without NEXT_PUBLIC check
**Why it's wrong:** Exposes secrets to browser
**Correct approach:** Keep secrets server-side only
**Rule reference:** security.mdc

### ERR-022: Missing CSP headers
**Pattern:** No Content-Security-Policy in next.config.js headers
**Why it's wrong:** XSS vulnerability
**Correct approach:** Define CSP (report-only in dev, enforced in prod)
**Rule reference:** security.mdc

### ERR-031: Dynamic code execution from user input
**Pattern:** `eval(userInput)`, `new Function(userInput)`, `require(userInput)`
**Why it's wrong:** Remote Code Execution (RCE) vulnerability - CVSS 9.9
**Correct approach:** Never execute user-provided strings as code. Use whitelisted operations only.
**Rule reference:** security-hardening.mdc - Section 1

### ERR-032: Constructor chain vulnerability
**Pattern:** Allowing access to `constructor.constructor` in template expressions
**Why it's wrong:** Enables sandbox escape via `constructor.constructor('return require("child_process")')().execSync('cmd')`
**Correct approach:** Block constructor access in user contexts, sanitize template expressions
**Rule reference:** security-hardening.mdc - Section 1

### ERR-033: Blacklist-based security
**Pattern:** Blocking specific dangerous functions instead of allowing only safe ones
**Why it's wrong:** Attackers find bypasses ("you didn't say no unicycles")
**Correct approach:** Use whitelist/allowlist - only permit explicitly allowed operations
**Rule reference:** security.mdc, security-hardening.mdc - Section 2

### ERR-034: Path traversal vulnerability
**Pattern:** `path.join(uploadDir, userFilename)` without validation
**Why it's wrong:** Attacker can use `../../../etc/passwd` to access arbitrary files
**Correct approach:** Validate resolved path starts with base directory + path.sep
**Rule reference:** security-hardening.mdc - Section 3

### ERR-035: Unsandboxed code execution
**Pattern:** Running user-provided code in main process without isolation
**Why it's wrong:** User code can access process credentials, files, network
**Correct approach:** Use process isolation, resource limits, filesystem restrictions
**Rule reference:** security-hardening.mdc - Section 2

### ERR-036: Shell command injection
**Pattern:** `exec(\`ls ${userInput}\`)`, `execSync(\`grep ${userInput} file\`)`
**Why it's wrong:** User can inject shell commands via input like `; rm -rf /`
**Correct approach:** Use parameterized commands, validate input against whitelist
**Rule reference:** security-hardening.mdc - Section 1

### ERR-037: Missing file content validation
**Pattern:** Trusting file extension without checking actual content
**Why it's wrong:** Attacker can upload malicious file with safe extension
**Correct approach:** Validate file magic bytes match expected type
**Rule reference:** security-hardening.mdc - Section 3

### ERR-038: Missing ownership check on resources
**Pattern:** Fetching resource by ID without verifying user owns it
**Why it's wrong:** Any authenticated user can access any resource (IDOR)
**Correct approach:** Always verify `resource.ownerId === currentUser.id` or proper permissions
**Rule reference:** security-hardening.mdc - Section 4

### ERR-039: Exposing internal errors to clients
**Pattern:** `res.status(500).json({ error: err.stack })`
**Why it's wrong:** Leaks internal paths, library versions, potential vulnerabilities
**Correct approach:** Log full error server-side, return generic message to client
**Rule reference:** security.mdc, api-patterns.mdc

### ERR-040: Loose dependency versions
**Pattern:** `"next": "^14.0.0"` or `"lodash": "*"` in package.json
**Why it's wrong:** Could pull vulnerable version automatically
**Correct approach:** Pin exact versions for security-critical packages
**Rule reference:** security-hardening.mdc - Section 6

### ERR-041: Exposed internal services
**Pattern:** Database, Redis, or admin interfaces accessible from internet
**Why it's wrong:** Direct attack surface for exploitation
**Correct approach:** Keep internal services on private network, use VPN/bastion for access
**Rule reference:** security-hardening.mdc - Section 8

### ERR-042: Git hooks from untrusted sources
**Pattern:** Cloning repos that may contain malicious .git/hooks
**Why it's wrong:** Post-checkout/post-merge hooks execute arbitrary code
**Correct approach:** Disable hooks when cloning untrusted repos, validate operations
**Rule reference:** security-hardening.mdc - Section 7

---

## CATEGORY: Performance

### ERR-023: Unoptimized images
**Pattern:** `<img>` instead of Next.js `<Image>`, missing dimensions
**Why it's wrong:** Causes layout shift, poor Core Web Vitals
**Correct approach:** Use `<Image>` with width/height, modern formats
**Rule reference:** performance.mdc

### ERR-024: Blocking scripts in head
**Pattern:** `<script src="...">` without async/defer
**Why it's wrong:** Blocks rendering, hurts LCP
**Correct approach:** Use `strategy="afterInteractive"` or `defer`
**Rule reference:** performance.mdc

---

## CATEGORY: Code Quality

### ERR-025: Missing AI Change Log
**Pattern:** Code changes without Change Log in response
**Why it's wrong:** Violates READ_THIS_FIRST.mdc Section 6
**Correct approach:** Every code change MUST include Change Log
**Rule reference:** READ_THIS_FIRST.mdc

### ERR-026: Not reading rules before coding
**Pattern:** Generating code without checking .mdc files
**Why it's wrong:** Results in repeated violations
**Correct approach:** Read READ_THIS_FIRST.mdc, then all rules, then code
**Rule reference:** READ_THIS_FIRST.mdc

### ERR-027: Using deprecated patterns
**Pattern:** Using patterns marked as deprecated/forbidden
**Why it's wrong:** Causes technical debt, potential penalties
**Correct approach:** Check seo-ai-readability.mdc Section 11 for deprecated list
**Rule reference:** seo-ai-readability.mdc

---

## CATEGORY: Links & Navigation

### ERR-028: Hardcoded URLs
**Pattern:** `<a href="https://domain.com/about">` instead of relative or config
**Why it's wrong:** Breaks in different environments (dev, staging, prod)
**Correct approach:** Use relative paths or SITE_CONFIG for cross-site
**Rule reference:** seo-ai-readability.mdc - Section 13

### ERR-029: External links without rel="noopener"
**Pattern:** `<a href="https://external.com" target="_blank">`
**Why it's wrong:** Security vulnerability, performance issue
**Correct approach:** Always add `rel="noopener noreferrer"` with `target="_blank"`
**Rule reference:** seo-ai-readability.mdc - Section 14

### ERR-030: Localhost URLs in production code
**Pattern:** `http://localhost:3000` hardcoded anywhere
**Why it's wrong:** Will break in production
**Correct approach:** Use environment variables or config
**Rule reference:** seo-ai-readability.mdc - Section 13

---

## Adding New Errors

When a new recurring error is identified:

1. Assign next ERR-XXX number
2. Document the pattern (what the bad code looks like)
3. Explain why it's wrong
4. Provide the correct approach
5. Reference the rule file

Format:
```
### ERR-XXX: [Short description]
**Pattern:** [What the error looks like]
**Why it's wrong:** [Explanation]
**Correct approach:** [How to fix]
**Rule reference:** [Which .mdc file]
```

---

## Error Count by Category

| Category | Count | Priority |
|----------|-------|----------|
| Typography & Design | 4 | High |
| SEO & Metadata | 5 | Critical |
| Content & Copy | 4 | Medium |
| Accessibility | 4 | High |
| Privacy & Tracking | 3 | Critical |
| Security | 14 | **CRITICAL** |
| Performance | 2 | High |
| Code Quality | 3 | Critical |
| Links & Navigation | 3 | High |

---

END OF FILE
